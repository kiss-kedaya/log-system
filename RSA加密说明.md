# RSA/AES混合加密方案说明

## 背景

为了解决原有系统中公开暴露AES密钥的安全问题，我们采用了RSA/AES混合加密方案。这种方案结合了非对称加密和对称加密的优点，既安全又高效。

## 加密流程

1. **系统初始化**：
   - 服务器生成RSA密钥对（私钥/公钥）
   - 私钥保存在服务器，公钥发送给客户端
   - 客户端在本地存储（localStorage）保存公钥

2. **客户端向服务器发送数据**：
   - 客户端生成临时的AES密钥
   - 使用AES密钥加密实际数据
   - 使用RSA公钥加密AES密钥
   - 将加密的AES密钥和加密的数据一起发送给服务器

3. **服务器处理数据**：
   - 使用RSA私钥解密得到AES密钥
   - 使用解密出的AES密钥解密实际数据
   - 处理请求

4. **服务器向客户端发送数据**：
   - 使用固定的AES密钥加密数据
   - 将加密数据发送给客户端

5. **客户端解密数据**：
   - 使用同样的固定AES密钥解密数据

## 数据格式

客户端发送的加密数据格式：

```
| 协议版本(1字节) | 加密密钥长度(4字节) | RSA加密的AES密钥 | AES IV(16字节) | AES加密的数据 |
```

## 安全性分析

1. **AES密钥保护**：
   - 每次请求使用不同的随机AES密钥
   - AES密钥通过RSA加密保护，无法被拦截

2. **私钥安全**：
   - RSA私钥只存在于服务器端，从不传输
   - 私钥保存在文件系统中，可以采用更严格的访问控制

3. **会话隔离**：
   - 每个请求使用独立的加密会话
   - 提高了抵抗重放攻击的能力

4. **降级保护**：
   - 服务器检查协议版本号，防止降级攻击

## 性能考量

1. **RSA加密开销**：
   - 仅用于加密小体量的AES密钥
   - 不会产生明显性能下降

2. **AES加密效率**：
   - 对称加密速度快，适合大体量数据
   - 采用高效的AES-CBC模式

## 部署注意事项

1. 确保RSA密钥的安全性：
   - `/keys`目录已在`.gitignore`中，避免意外提交
   - 生产环境应考虑使用更安全的密钥存储方案（如密钥管理服务）

2. 密钥轮转：
   - 实现密钥定期轮转机制
   - 考虑添加密钥版本管理

3. 错误处理：
   - 加密/解密错误日志不应暴露敏感信息

## 后续优化方向

1. 实现客户端与服务器双向加密：
   - 服务器也使用客户端公钥加密响应

2. 添加消息认证码(MAC)：
   - 防止密文被篡改

3. 引入证书链：
   - 提高密钥交换的安全性
